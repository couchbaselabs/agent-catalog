name: Publish
run-name: ðŸ‘ï¸ ${{ github.actor }} has pushed a new commit!
on:
  push:
    tags:
      - '*.*.*'

jobs:
  Pages:
    runs-on: ubuntu-latest

    steps:
      - run: echo "ðŸŽ‰ The job was automatically triggered by a ${{ github.event_name }} event."

      - name: Check out repository code
        uses: actions/checkout@v4
      - run: echo "ðŸ’¡ The ${{ github.repository }} repository has been cloned to the runner."

      - name: Set up Python Poetry
        uses: mishaga/action-poetry@1
        with:
          python-version: "3.12"
          poetry-version: "latest"
          shell: "bash"

      - name: Add Poetry to path
        run: echo "${HOME}/.poetry/bin" >> $GITHUB_PATH

      - name: Config our publishing repo
        run: |
          poetry config repositories.testpypi https://test.pypi.org/legacy/
          poetry config pypi-token.testpypi ${{ secrets.TEST_PYPI_API_KEY }}

      - name: Build and publish the agentc_core package
        run: |
          cd libs/agentc_core
          poetry build
          poetry publish -r testpypi

      - name: Build the agentc_cli package
        run: |
          cd libs/agentc_cli
          poetry build
          poetry publish -r testpypi

      - name: Build the agentc_langchain package
        run: |
          cd libs/agentc_langchain
          poetry build
          poetry publish -r testpypi

      - name: Build the agentc package
        run: |
          cd libs/agentc
          poetry build
          poetry publish -r testpypi
